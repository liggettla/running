<!DOCTYPE html>
<html>

<head>
    <title>Running Log</title>

    <style>
        /* This is a basic CSS to position the username on the top right corner */
        .username-display {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>
<body>

    <!-- This block will check if the user is authenticated and then display the username -->
    {% if user.is_authenticated %}
    <div class="username-display">
        {{ user.username }}
        <br>
        <a href="{% url 'logout' %}">Logout</a>
    </div>
    {% endif %}

    <h2>Running Log</h2>
    <!-- link to the running log app -->
    <a href="/">Home</a>
    <!-- A form for adding a run. The 'method="post"' means that this form will send a POST request when submitted. -->
    <form method="post">
        <!-- This is a security feature that protects against certain types of attacks. -->
        {% csrf_token %}
        <!-- The form fields. 'form.as_p' means to render the form fields as paragraphs. -->
        {{ form.as_p }}
        <!-- The submit button for the form. -->
        <button type="submit">Add run</button>
    </form>
    <h3>Your runs:</h3>
    <!-- A list of the user's runs. -->
    <ul>
        <!-- Loop over each run in 'runs'. -->
        {% for run in runs %}
        <li>
            <!-- Display the date, distance, and time of the run. -->
            Date: {{ run.date }}, Distance: {{ run.distance }} km, Time: {{ run.time }}
        </li>
        <!-- If 'runs' is empty (i.e., the user has no runs), display 'No runs yet.' -->
        {% empty %}
        <li>No runs yet.</li>
        {% endfor %}
    </ul>

    <!-- Example chart using Chart.js -->
    <canvas id="myChart"></canvas>

    <script>
        // Collect all of the runs in the database
        const run_distances = [
            {% for run in runs %}
                {{ run.distance|default_if_none:"null" }},
            {% endfor %}
        ];
        const labels = [
            {% for run in runs %}
                "Label {{ forloop.counter }}",
            {% endfor %}
        ];

        // Define the data and configuration
        const data = {
            labels: labels,
            datasets: [{
                label: 'My First Dataset',
                data: run_distances,
                fill: false,
                borderColor: 'rgb(75, 192, 192)',
                tension: 0.1,
                backgroundColor: 'rgb(75, 192, 192)',
            }]
        };
    
        const config = {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                plugins: {
                title: {
                    display: true,
                    text: 'Running Log'
                }
                },
                scales: {
                y: {
                    beginAtZero: true
                }
                },
                animation: { // Enable animation
                duration: 500, // Set the animation duration to 2 seconds
                easing: 'easeOutQuad' // Set the easing function for the animation
                },
                maxHeight: 400, // Set the max height of the chart to 400 pixels
                maxWidth: 600, // Set the max width of the chart to 600 pixels
            }
            };

            var myChart = new Chart(
            document.getElementById('myChart'),
            config
            );
    </script>
</body>
</html>
